# خطة تنفيذ منصة "أداء" - خطة العمل التفصيلية

## نظرة عامة

هذا المستند يحتوي على خطة العمل الشاملة لتنفيذ منصة "أداء" لتقييم وتطوير تمريض وحدة القسطرة. الخطة مقسمة إلى مراحل رئيسية ومهام فرعية تفصيلية.

---

## المرحلة 0: الإعداد والتخطيط (يوم 1)

### 0.1 إعداد البيئة التطويرية
- [x] إنشاء مشروع React + TypeScript + Vite
- [x] تثبيت shadcn/ui و Tailwind CSS
- [x] إعداد نظام التصميم الأساسي

### 0.2 إعداد Supabase
- [x] تفعيل Lovable Cloud
- [x] إنشاء قاعدة البيانات بالجداول المطلوبة
- [x] إعداد RLS policies
- [x] إعداد نظام المصادقة

### 0.3 التوثيق الأولي
- [x] إنشاء ملف project-brief.md
- [x] إنشاء ملف implementation-plan.md

---

## المرحلة 1: نظام التصميم والبنية الأساسية (يوم 1-2)

### 1.1 تصميم نظام الألوان والخطوط
**الهدف:** إنشاء هوية بصرية احترافية وجذابة

**المهام الفرعية:**
- [x] تحديد الألوان الأساسية (Primary colors) - تدرجات الأزرق/الأخضر الطبي
- [x] تحديد الألوان الثانوية للحالات المختلفة (نجاح، تحذير، خطأ)
- [x] إنشاء تدرجات لونية (Gradients) للأقسام المميزة
- [x] اختيار الخطوط العربية الواضحة (مثل: Tajawal, Cairo)
- [x] إنشاء متغيرات CSS في index.css
- [x] تحديث tailwind.config.ts بالألوان والخطوط

### 1.2 مكونات UI الأساسية
**الهدف:** إنشاء مكتبة مكونات قابلة لإعادة الاستخدام

**المهام الفرعية:**
- [x] تخصيص مكون Button بـ variants جديدة (hero, success, warning)
- [x] تخصيص مكون Card للبطاقات المختلفة
- [x] إنشاء مكون Avatar للصور الشخصية
- [x] إنشاء مكون Badge للشارات والحالات
- [x] إنشاء مكون ProgressBar لشريط التقدم
- [x] إنشاء مكون RatingCircles للتقييم بالدوائر (1-5)

### 1.3 نظام التخطيط (Layout System)
**المهام الفرعية:**
- [x] إنشاء مكون AuthLayout للصفحات غير المصادق عليها
- [x] إنشاء مكون SupervisorLayout للمشرفين
- [x] إنشاء مكون ManagerLayout لمدير الوحدة
- [x] إنشاء Sidebar للتنقل
- [x] إنشاء Header مع معلومات المستخدم

---

## المرحلة 2: قاعدة البيانات ونظام المصادقة (يوم 2-3)

### 2.1 إعداد Schema في Supabase
**الهدف:** إنشاء البنية الأساسية لقاعدة البيانات

**المهام الفرعية:**
- [x] إنشاء جدول profiles
  - [x] إضافة حقل role (manager/supervisor)
  - [x] إضافة حقول إضافية (name, phone, etc.)
  - [x] ربطه بـ auth.users عبر Trigger

- [x] إنشاء جدول nurses
  - [x] id, name, photo_url, is_active
  - [x] created_at, updated_at
  - [x] metadata إضافي إذا لزم

- [x] إنشاء جدول evaluations
  - [x] id, nurse_id, supervisor_id
  - [x] type (weekly/monthly)
  - [x] evaluation_date
  - [x] scores (JSONB)
  - [x] notes (JSONB)
  - [x] final_score (calculated)

- [x] إنشاء جدول audits
  - [x] id, evaluation_id, auditor_id
  - [x] is_match, auditor_notes, decision

### 2.2 Row Level Security (RLS)
**المهام الفرعية:**
- [x] إنشاء policies للمديرين (قراءة/كتابة كاملة)
- [x] إنشاء policies للمشرفين (قراءة/كتابة محدودة)
- [x] إنشاء policies لجدول nurses
- [x] إنشاء policies لجدول evaluations
- [x] إنشاء policies لجدول audits

### 2.3 نظام المصادقة
**المهام الفرعية:**
- [x] إنشاء صفحة تسجيل الدخول (/auth/login)
- [x] إنشاء AuthContext لإدارة حالة المستخدم
- [x] إنشاء ProtectedRoute لحماية الصفحات
- [x] إنشاء RoleBasedRoute للتحكم بالأدوار
- [x] معالجة حالات الأخطاء في المصادقة

---

## المرحلة 2.5: تجريد طبقة البيانات وإعداد قاعدة بيانات محلية

**الهدف:** إنشاء بيئة تطوير محلية كاملة باستخدام قاعدة بيانات حقيقية قابلة للتفاعل.

**المهام الفرعية:**
- [x] تثبيت `json-server` لإدارة قاعدة البيانات المحلية.
- [x] إنشاء ملف `db.json` مع بيانات أولية.
- [x] إضافة سكربت `npm` لتشغيل خادم قاعدة البيانات.
- [x] تحديث `api.ts` للتفاعل مع `json-server` عبر طلبات HTTP.
- [x] تحديث نظام المصادقة لدعم تسجيل الدخول المحلي.
- [x] إنشاء ملف `config.ts` مركزي للتحكم بوضع التشغيل.

---

## المرحلة 3: واجهة المشرف (Supervisor Interface) (يوم 3-5)

### 3.1 صفحة تسجيل الدخول
**المهام الفرعية:**
- [x] تصميم صفحة تسجيل دخول جذابة
- [x] إضافة شعار الوحدة
- [x] ربط النموذج بـ Supabase Auth
- [x] إضافة validation للإدخالات
- [x] معالجة الأخطاء وعرضها

### 3.2 الصفحة الرئيسية للمشرف (/supervisor/dashboard)
**المهام الفرعية:**
- [x] تصميم الواجهة الرئيسية
- [x] إضافة تحية بالاسم
- [x] زر "ابدأ تقييم جديد" كبير وبارز
- [x] عرض قائمة بآخر 5 تقييمات
- [x] إضافة إحصائيات بسيطة

### 3.3 صفحة التقييم (/supervisor/evaluate)
**المهام الفرعية:**

#### 3.3.1 الخطوة 1: اختيار الممرض
- [x] إنشاء مكون NurseSelector
- [x] جلب قائمة الممرضين النشطين من قاعدة البيانات
- [x] عرض الصور والأسماء بشكل جذاب
- [x] البحث والفلترة

#### 3.3.2 الخطوة 2: اختيار نوع التقييم
- [x] إنشاء مكون EvaluationTypeSelector
- [x] زر "أسبوعي" - 9 بنود
- [x] زر "شهري" - 29 بند
- [x] عرض شرح مختصر لكل نوع

#### 3.3.3 الخطوة 3: ملء الاستبيان
- [x] إنشاء مكون EvaluationForm
- [x] عرض البنود حسب النوع المختار
- [x] مكون RatingCircles لكل بند (1-5)
- [x] مربع نص للملاحظات لكل بند
- [x] شريط التقدم (ProgressBar)
- [x] حفظ مؤقت للبيانات (localStorage)

#### 3.3.4 إرسال التقييم
- [x] حساب النتيجة النهائية
- [x] التحقق من اكتمال جميع البنود
- [x] حفظ البيانات في Supabase
- [x] رسالة نجاح مع ملخص النتيجة
- [x] إعادة توجيه للصفحة الرئيسية

### 3.4 صفحة التقييمات السابقة (/supervisor/history)
**المهام الفرعية:**
- [x] عرض جميع التقييمات السابقة
- [x] فلترة حسب: الممرض، النوع، التاريخ
- [x] عرض تفاصيل أي تقييم سابق (view only)
- [x] إمكانية التصدير (PDF/Excel)

---

## المرحلة 4: لوحة تحكم المدير (Manager Dashboard) (يوم 5-8)

### 4.1 الصفحة الرئيسية (/manager/dashboard)
**المهام الفرعية:**

#### 4.1.1 مؤشرات الأداء الرئيسية (KPIs)
- [x] إنشاء مكون `KPICard`.
- [x] ربط لوحة التحكم بالبيانات المحلية من `json-server`.
- [x] حساب متوسط أداء الوحدة ديناميكيًا.
- [x] عد التقييمات المكتملة ديناميكيًا.
- [x] تحديد الممرض الأعلى أداءً ديناميكيًا.
- [x] عرض المؤشرات بشكل بصري جذاب.

#### 4.1.2 الرسوم البيانية
- [x] تثبيت مكتبة `recharts`.
- [x] إنشاء `Line Chart` لتطور الأداء (آخر 6 أشهر).
- [x] إنشاء `Bar Chart` لمتوسط الأداء حسب المحاور.
- [x] إنشاء `Pie Chart` لتوزيع التقديرات.
- [x] جعل الرسوم تفاعلية

#### 4.1.3 قائمة "تحت المجهر"
- [x] إنشاء مكون TopPerformers
- [x] جلب أفضل 3 ممرضين
- [x] عرض الصور والدرجات
- [x] إنشاء مكون NeedsAttention
- [x] جلب أقل 3 ممرضين
- [x] اقتراحات تلقائية للتحسين

### 4.2 صفحة فريق التمريض (/manager/nurses)
**المهام الفرعية:**

#### 4.2.1 جدول الممرضين
- [x] إنشاء جدول شامل بجميع الممرضين
- [x] الأعمدة: الصورة، الاسم، متوسط الأداء، مؤشر الأداء، إجراءات
- [x] ميزة البحث
- [x] ميزة الفرز حسب الأعمدة
- [x] Pagination للبيانات الكبيرة

#### 4.2.2 مؤشر الأداء
- [x] حساب التغيير مقارنة بالشهر السابق
- [x] عرض سهم أخضر (تحسن) أو أحمر (تراجع)
- [x] عرض نسبة التغيير

#### 4.2.3 إدارة الممرضين
- [x] زر "إضافة ممرض جديد"
- [x] نموذج إضافة/تعديل ممرض
- [x] رفع صورة الممرض
- [x] تفعيل/إلغاء تفعيل ممرض
- [x] حذف ممرض (soft delete)

### 4.3 صفحة الملف الشخصي للممرض (/manager/nurses/:id)
**المهام الفرعية:**

#### 4.3.1 بطاقة المعلومات الأساسية
- [x] عرض صورة الممرض
- [x] عرض الاسم والمعلومات
- [x] عرض تاريخ التعيين وبين قوسين المدة منتاريخ التعيين حتى اليوم
- [x] عرض متوسط الأداء العام
- [x] عرض التقدير (ممتاز، جيد جدًا، إلخ)

#### 4.3.2 تحليل الأداء
- [x] Bar Chart لمتوسط كل محور (فني، سلوكي، رعاية، مبادرة)
- [x] Line Chart لتطور الأداء عبر الزمن
- [x] مقارنة مع متوسط الوحدة

#### 4.3.3 التحليل التلقائي
- [x] خوارزمية لتحديد أفضل 3 بنود (نقاط القوة)
- [x] خوارزمية لتحديد أسوأ 3 بنود (فرص التحسين)
- [x] عرض النتائج بشكل بصري جذاب
- [x] اقتراحات تحسين تلقائية

#### 4.3.4 سجل التقييمات
- [x] جدول زمني بجميع التقييمات (مع عرض اسم المشرف)
- [x] فلترة حسب النوع والتاريخ
- [x] عرض تفاصيل كل تقييم
- [x] مقارنة بين تقييمات مختلفة

### 4.4 صفحة المراجعات العشوائية (/manager/audits)
**المهام الفرعية:**

- [x] **4.4.1. الإعداد الأولي:**
  - [x] إنشاء المكون الأساسي للصفحة.
  - [x] إضافة المسار (route) في `App.tsx`.
  - [x] إضافة رابط في الشريط الجانبي للمدير.

#### 4.4.2 قائمة المراجعات
- [x] عرض جميع المراجعات السابقة
- [x] فلترة حسب المدقق والقرار
- [x] إحصائيات عن إجمالي المراجعات ومعدل التطابق

#### 4.4.3 إجراء مراجعة جديدة
- [x] اختيار تقييم عشوائي غير مراجع
- [x] عرض تفاصيل التقييم الأصلي
- [x] نموذج للمراجعة (التطابق، ملاحظات، قرار)
- [x] حفظ المراجعة في قاعدة البيانات
- [x] تحديث الدرجة إذا لزم (مهمة مستقبلية)

### 4.5 صفحة إدارة المشرفين (/manager/supervisors)
**المهام الفرعية:**

- [x] **4.5.1. الإعداد الأولي:**
  - [x] إنشاء المكون الأساسي للصفحة.
  - [x] إضافة المسار (route) في `App.tsx`.
  - [x] إضافة رابط في الشريط الجانبي للمدير.
- [x] عرض قائمة المشرفين
- [x] إضافة مشرف جديد
- [x] تعديل صلاحيات المشرف
- [x] تحليل أداء المشرف (معدل الدرجات، التطابق)
- [x] إحصائيات عن كل مشرف

### 4.6 صفحة التقارير والإحصائيات (/manager/reports)
**المهام الفرعية:**
- [x] **4.6.1. الإعداد الأولي:**
  - [x] إنشاء المكون الأساسي للصفحة.
  - [x] إضافة المسار (route) في `App.tsx`.
  - [x] إضافة رابط في الشريط الجانبي للمدير.
- [x] تقرير شهري شامل
- [x] تقرير مقارن (شهر/شهر)
- [x] تقرير بالبنود الأكثر/الأقل أداءً
- [x] تقرير بالممرضين المتميزين
- [x] تصدير التقارير (PDF/Excel)

---

## المرحلة 5: الميزات المتقدمة (يوم 8-10)

### 5.1 نظام الشارات (Gamification) - **(تمت إعادة الهيكلة)**
**الهدف:** إنشاء نظام شارات ديناميكي وقابل للتخصيص.

**المهام الفرعية:**
- [x] **5.1.1 إعادة هيكلة البيانات:**
  - [x] تحديث `types/index.ts` لدعم مستويات الشارات (Tiers) والألوان.
  - [x] تحديث `db.json` بالبنية الجديدة للشارات متعددة المستويات.
- [x] **5.1.2 تحديث واجهة برمجة التطبيقات:**
  - [x] إضافة دوال CRUD للشارات في `lib/api.ts`.
- [x] **5.1.3 إنشاء واجهة الإدارة:**
  - [x] إنشاء صفحة `/manager/badges` لعرض الشارات.
  - [x] إضافة المسار (Route) للصفحة الجديدة في `App.tsx`.
  - [x] إضافة رابط التنقل في الشريط الجانبي للمدير.
- [x] **5.1.4 تطوير واجهة الإدارة:**
  - [x] إنشاء نموذج لإضافة/تعديل الشارات.
  - [x] السماح بتحديد أيقونة ولون لكل مستوى.
  - [x] واجهة ديناميكية لتحديد المعايير لكل مستوى.
- [x] **5.1.5 تطوير خوارزمية المنح:**
  - [x] تحديث `gamification.ts` لجلب الشارات من الـ API.
  - [x] تنفيذ خوارزمية تقييم المعايير متعددة المستويات.
- [x] **5.1.6 عرض الشارات:**
  - [x] عرض الشارات المكتسبة في ملف الممرض الشخصي.
  - [x] إنشاء صفحة لعرض جميع الشارات المتاحة وكيفية الحصول عليها.

### 5.2 الإشعارات (Notifications)
**المهام الفرعية:**
- [x] إنشاء جدول notifications في `db.json`
- [x] إضافة دوال API لجلب وتحديث الإشعارات
- [x] تصميم مكون الإشعارات في الـ Header
- [x] ربط المكون بواجهة API لجلب الإشعارات
- [x] إمكانية تحديد الإشعار كمقروء وتحديد الكل كمقروء
- [x] إشعار عند تقييم جديد
- [x] إشعار عند مراجعة عشوائية
- [x] إشعار عند منح شارة جديدة
- [x] إشعار عند انخفاض الأداء (مهمة مستقبلية)
- [ ] تحديث الإشعارات في الوقت الفعلي (Realtime) (مهمة مستقبلية)

### 5.3 نظام التنبيهات الذكية
**المهام الفرعية:**
- [x] خوارزمية للكشف عن انخفاض الأداء
- [x] عرض التنبيهات في صفحة ملف الممرض
- [x] اقتراحات تلقائية للإجراءات (مهمة مستقبلية)
- [x] تنبيه عند تكرار الأخطاء (مهمة مستقبلية)
- [x] تنبيه عند الحاجة للتدريب (مهمة مستقبلية)

### 5.4 خطط التحسين الفردية (IDP)
**المهام الفرعية:**
- [x] إنشاء جدول improvement_plans
- [x] نموذج لإنشاء خطة تحسين
- [x] تحديد الأهداف والمدة
- [x] متابعة التقدم
- [x] تقييم النتائج

---

## المرحلة 6: التحسينات والتهيئة (يوم 10-12)

### 6.1 الأداء والتحسينات
**المهام الفرعية:**
- [ ] تحسين أداء الاستعلامات
- [ ] إضافة Caching للبيانات المتكررة
- [x] التأكد من أن التطبيق بالكامل يعمل ببيانات حقيقية وليس بيانات وهمية (تم الانتقال بالكامل إلى Supabase)
- [ ] تحسين تحميل الصور (lazy loading)
- [ ] تقليل حجم الحزمة (bundle size)
- [ ] تحسين الأداء على الهواتف

### 6.2 إمكانية الوصول (Accessibility)
**المهام الفرعية:**
- [ ] إضافة ARIA labels
- [ ] دعم لوحة المفاتيح
- [ ] تحسين التباين اللوني
- [ ] دعم قارئات الشاشة
- [ ] اختبار مع أدوات Accessibility

### 6.3 تحسين محركات البحث (SEO)
**المهام الفرعية:**
- [ ] تحديث meta tags
- [ ] إضافة Open Graph tags
- [ ] إنشاء sitemap
- [ ] إضافة structured data
- [ ] تحسين أوقات التحميل

### 6.4 PWA (Progressive Web App)
**المهام الفرعية:**
- [ ] إنشاء manifest.json
- [ ] إعداد Service Worker
- [ ] إضافة أيقونات التطبيق
- [ ] دعم التثبيت على الشاشة الرئيسية
- [ ] دعم العمل بدون إنترنت (offline)

---

## المرحلة 7: الاختبار والجودة (يوم 12-13)

### 7.1 الاختبار الوظيفي
**المهام الفرعية:**
- [ ] اختبار تسجيل الدخول
- [ ] اختبار إنشاء تقييم جديد
- [ ] اختبار الحسابات الرياضية
- [ ] اختبار المراجعات العشوائية
- [ ] اختبار الصلاحيات والأدوار

### 7.2 اختبار الأجهزة المختلفة
**المهام الفرعية:**
- [ ] اختبار على هواتف مختلفة
- [ ] اختبار على أجهزة لوحية
- [ ] اختبار على أحجام شاشات مختلفة
- [ ] اختبار على متصفحات مختلفة

### 7.3 اختبار الأداء
**المهام الفرعية:**
- [ ] قياس سرعة التحميل
- [ ] اختبار تحت الضغط
- [ ] اختبار استهلاك الذاكرة
- [ ] تحسين الأداء حسب النتائج

### 7.4 مراجعة الكود
**المهام الفرعية:**
- [ ] مراجعة جودة الكود
- [ ] إزالة الكود غير المستخدم
- [ ] توحيد أسلوب الكتابة
- [ ] إضافة تعليقات للكود المعقد
- [ ] تحسين البنية العامة

---

## المرحلة 8: التوثيق والتسليم (يوم 13-14)

### 8.1 توثيق المستخدم
**المهام الفرعية:**
- [ ] دليل المشرف
- [ ] دليل المدير
- [ ] فيديوهات تعليمية (اختياري)
- [ ] أسئلة شائعة (FAQ)

### 8.2 التوثيق التقني
**المهام الفرعية:**
- [ ] توثيق قاعدة البيانات
- [ ] توثيق الـ API
- [ ] توثيق المكونات
- [ ] دليل النشر

### 8.3 النشر النهائي
**المهام الفرعية:**
- [ ] إعداد بيئة الإنتاج
- [ ] مراجعة نهائية للكود
- [ ] نشر على Lovable/Cloudflare
- [ ] اختبار النسخة المنشورة
- [ ] إعداد نسخ احتياطية

---

## مخطط زمني تقديري

| المرحلة | المدة المقدرة | الأولوية |
|---------|---------------|----------|
| المرحلة 0: الإعداد | 0.5 يوم | حرجة |
| المرحلة 1: نظام التصميم | 1 يوم | حرجة |
| المرحلة 2: قاعدة البيانات | 1 يوم | حرجة |
| المرحلة 3: واجهة المشرف | 2 يوم | حرجة |
| المرحلة 4: لوحة المدير | 3 أيام | حرجة |
| المرحلة 5: الميزات المتقدمة | 2 يوم | متوسطة |
| المرحلة 6: التحسينات | 2 يوم | متوسطة |
| المرحلة 7: الاختبار | 1 يوم | عالية |
| المرحلة 8: التوثيق والنشر | 1 يوم | عالية |
| **المجموع** | **13.5 يوم** | - |

---

## المعايير والمقاييس

### معايير النجاح
- ✅ جميع الوظائف الأساسية تعمل بشكل صحيح
- ✅ التصميم متجاوب على جميع الأحجام
- ✅ سرعة التحميل أقل من 3 ثواني
- ✅ معدل الأخطاء أقل من 1%
- ✅ رضا المستخدمين أكثر من 90%

### مقاييس الأداء
- **Page Load Time**: < 3s
- **Time to Interactive**: < 5s
- **First Contentful Paint**: < 1.5s
- **Bundle Size**: < 500KB (gzipped)

---

## المخاطر والحلول

### المخاطر المحتملة

1. **تعقيد الحسابات الرياضية**
   - الحل: إنشاء وحدة منفصلة للحسابات مع اختبارات شاملة

2. **أداء قاعدة البيانات**
   - الحل: استخدام Indexes مناسبة، Caching

3. **تعقيد واجهة التقييم**
   - الحل: تقسيم إلى خطوات، حفظ مؤقت

4. **صلاحيات وأمان البيانات**
   - الحل: RLS صارمة، اختبارات أمنية

---

## الملاحظات الهامة

### أولويات التنفيذ
1. **الأساسيات أولاً**: المصادقة، قاعدة البيانات، واجهة المشرف
2. **الوظائف الأساسية**: التقييم الأسبوعي والشهري
3. **لوحة المدير**: KPIs والرسوم البيانية
4. **الميزات المتقدمة**: الشارات، الإشعارات
5. **التحسينات**: PWA، SEO، Performance

### نقاط الفحص (Checkpoints)
- ✅ نهاية يوم 3: واجهة المشرف كاملة وعاملة
- ✅ نهاية يوم 8: لوحة المدير الأساسية جاهزة
- ✅ نهاية يوم 12: جميع الميزات مكتملة
- ✅ نهاية يوم 14: التطبيق جاهز للنشر

---

## التحديثات المستقبلية (Post-Launch)

### النسخة 1.1
- [ ] تطبيق جوال أصلي (React Native)
- [ ] تكامل مع أنظمة المستشفى الأخرى
- [ ] تقارير متقدمة مع AI
- [ ] نظام رسائل داخلي

### النسخة 1.2
- [ ] دعم متعدد اللغات
- [ ] نظام تدريب متكامل
- [ ] مكتبة فيديوهات تعليمية
- [ ] نظام مكافآت متقدم

---

## خلاصة

هذه الخطة توفر roadmap شاملة لتطوير منصة "أداء". يجب مراجعتها وتحديثها بشكل دوري حسب التقدم الفعلي وأي تغييرات في المتطلبات.

**تاريخ آخر تحديث**: ${new Date().toLocaleDateString('ar-SA')}
